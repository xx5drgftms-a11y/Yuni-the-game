<!doctype html><html lang='it'><head><meta charset='utf-8'/><meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no'/><title>Yunij – L'isola perduta (Web)</title><link rel='stylesheet' href='style.css'/></head><body><canvas id='gameCanvas'></canvas><div id='ui'><div id='screen-voice' class='screen active'><div class='box'><h1>🎙️ Scegli la voce narrante</h1><div><button class='btn' data-voice='male'>👨 Maschile epica</button><button class='btn' data-voice='female'>👩 Femminile fiaba</button><button class='btn' data-voice='fantasy'>🧙 Fantasy magica</button></div><small>Tocca per iniziare • Poi usa joystick + Attacco/Schivata</small></div></div><div id='screen-overlay' class='screen'><div class='badge' id='subtitle'></div></div></div><div id='hud'><div class='joy' id='joy'><div class='knob' id='knob'></div></div><div class='btnB' id='btnDodge'>Schiva</div><div class='btnA' id='btnAttack'>Attacca</div></div><audio id='ambient' src='audio/ambient.wav' loop></audio><audio id='voice_male' src='audio/voice_male.wav'></audio><audio id='voice_female' src='audio/voice_female.wav'></audio><audio id='voice_fantasy' src='audio/voice_fantasy.wav'></audio><script>const c=document.getElementById('gameCanvas'),x=c.getContext('2d');let W,H,D=window.devicePixelRatio||1;function R(){W=innerWidth;H=innerHeight;c.width=W*D;c.height=H*D;c.style.width=W+'px';c.style.height=H+'px';x.setTransform(D,0,0,D,0,0)}addEventListener('resize',R);R();const A=document.getElementById('ambient'),Vm=document.getElementById('voice_male'),Vf=document.getElementById('voice_female'),Vx=document.getElementById('voice_fantasy');let SV='female';const S1=document.getElementById('screen-voice'),S2=document.getElementById('screen-overlay'),T=document.getElementById('subtitle');document.querySelectorAll('[data-voice]').forEach(b=>b.addEventListener('click',async e=>{SV=e.target.dataset.voice;S1.classList.remove('active');S2.classList.add('active');T.textContent='Yunjì si risveglia su un’isola misteriosa... trova un’arma e sfuggi ai goblin!';try{await A.play()}catch(e){}let v=SV==='male'?Vm:SV==='fantasy'?Vx:Vf;try{await v.play()}catch(e){}setTimeout(()=>T.textContent='',4000);Q()}));const J=document.getElementById('joy'),K=document.getElementById('knob'),BA=document.getElementById('btnAttack'),BB=document.getElementById('btnDodge');let ja=false,JC={x:0,y:0},JV={x:0,y:0};function JP(){const r=J.getBoundingClientRect();return{x:r.left+r.width/2,y:r.top+r.height/2,rad:r.width/2-10}}function setK(x,y){const r=J.getBoundingClientRect();K.style.left=(x-r.left-30)+'px';K.style.top=(y-r.top-30)+'px'}function NM(v){const m=Math.hypot(v.x,v.y)||1;return{x:v.x/m,y:v.y/m,m}}function JS(x,y){ja=true;const j=JP();JC={x:j.x,y:j.y,rad:j.rad};const v={x:x-j.x,y:y-j.y};const n=NM(v);const d=Math.min(n.m,j.rad);JV={x:n.x*d/j.rad,y:n.y*d/j.rad};setK(j.x+n.x*d,j.y+n.y*d)}function JM(x,y){if(!ja)return;const j=JP();const v={x:x-j.x,y:y-j.y};const n=NM(v);const d=Math.min(n.m,j.rad);JV={x:n.x*d/j.rad,y:n.y*d/j.rad};setK(j.x+n.x*d,j.y+n.y*d)}function JE(){ja=false;JV={x:0,y:0};const r=J.getBoundingClientRect();setK(r.left+r.width/2,r.top+r.height/2)}J.addEventListener('touchstart',e=>{const t=e.touches[0];JS(t.clientX,t.clientY)},{passive:true});J.addEventListener('touchmove',e=>{const t=e.touches[0];JM(t.clientX,t.clientY)},{passive:true});J.addEventListener('touchend',JE);J.addEventListener('mousedown',e=>JS(e.clientX,e.clientY));addEventListener('mousemove',e=>JM(e.clientX,e.clientY));addEventListener('mouseup',JE);let AT=false,DG=false;BA.addEventListener('touchstart',()=>AT=true,{passive:true});BA.addEventListener('mousedown',()=>AT=true);BB.addEventListener('touchstart',()=>DG=true,{passive:true});BB.addEventListener('mousedown',()=>DG=true);addEventListener('keydown',e=>{if(e.code==='Space')AT=true;if(e.code==='ShiftLeft'||e.code==='ShiftRight')DG=true});const S={P:{x:0,y:0,r:18,d:0,s:140,i:0},G:[],PP:[],I:{r:Math.min(Math.min(W,H)*0.35,260)},t:0,ls:0,si:2,sc:0};function SG(){const a=Math.random()*Math.PI*2;const R=S.I.r*0.9;S.G.push({x:Math.cos(a)*R,y:Math.sin(a)*R,r:14,h:2,t:0})}function Q(){S.G.length=0;S.sc=0;S.t=0;for(let i=0;i<4;i++)SG();L(0)}let Ls=0;function L(t){const dt=Math.min(0.033,(t-Ls)/1000||0);Ls=t;U(dt);D();requestAnimationFrame(L)}function U(dt){S.t+=dt;S.P.i=Math.max(0,S.P.i-dt);const v=JV;const l=Math.hypot(v.x,v.y);if(l>0.03){S.P.x+=v.x*S.P.s*dt;S.P.y+=v.y*S.P.s*dt;S.P.d=Math.atan2(v.y,v.x)}const d=Math.hypot(S.P.x,S.P.y);const m=S.I.r-S.P.r-6;if(d>m){const k=m/d;S.P.x*=k;S.P.y*=k}if(S.t-S.ls>S.si&&S.G.length<12){SG();S.ls=S.t}for(const g of S.G){const dx=S.P.x-g.x,dy=S.P.y-g.y;const dist=Math.hypot(dx,dy);const sp=60+Math.sin((g.t+=dt)*2)*6;if(dist>2){g.x+=dx/dist*sp*dt;g.y+=dy/dist*sp*dt}if(dist<g.r+S.P.r&&S.P.i<=0){S.P.i=1.0;const nx=dx/dist,ny=dy/dist;S.P.x-=nx*20;S.P.y-=ny*20}}if(AT){AT=false;const Rg=36,ac=Math.PI/2;for(const g of S.G){const dx=g.x-S.P.x,dy=g.y-S.P.y;const dist=Math.hypot(dx,dy);const a=Math.atan2(dy,dx);const da=Math.atan2(Math.sin(a-S.P.d),Math.cos(a-S.P.d));if(dist<S.P.r+Rg&&Math.abs(da)<ac*0.5){g.h-=1;S.PP.push({x:g.x,y:g.y,vx:dx*0.5,vy:dy*0.5,t:0})}}}if(DG){DG=false;S.P.x+=Math.cos(S.P.d)*60;S.P.y+=Math.sin(S.P.d)*60}for(let i=S.G.length-1;i>=0;i--){if(S.G[i].h<=0){S.G.splice(i,1);S.sc++}}for(const p of S.PP){p.x+=p.vx*dt;p.y+=p.vy*dt;p.t+=dt}S.PP=S.PP.filter(p=>p.t<0.25)}function D(){const cx=W/2,cy=H/2+30;x.clearRect(0,0,W,H);const g=x.createRadialGradient(cx,cy,S.I.r*0.7,cx,cy,S.I.r*1.6);g.addColorStop(0,'#7ee2f0');g.addColorStop(1,'#4dbfd6');x.fillStyle=g;x.beginPath();x.arc(cx,cy,S.I.r*1.5,0,Math.PI*2);x.fill();x.fillStyle='#B9855E';x.beginPath();x.arc(cx,cy,S.I.r,0,Math.PI*2);x.fill();x.fillStyle='#5FB36A';x.beginPath();x.arc(cx,cy,S.I.r*0.78,0,Math.PI*2);x.fill();x.strokeStyle='#2F7E4A';x.lineWidth=6;x.beginPath();x.arc(cx,cy,S.I.r*0.78,0,Math.PI*2);x.stroke();const px=cx+S.P.x,py=cy+S.P.y;x.fillStyle='#f4f9ff';x.strokeStyle='#111';x.lineWidth=4;x.beginPath();x.arc(px,py,S.P.r,0,Math.PI*2);x.fill();x.stroke();const sx=px+Math.cos(S.P.d)*S.P.r,sy=py+Math.sin(S.P.d)*S.P.r;x.strokeStyle='#222';x.beginPath();x.moveTo(px,py);x.lineTo(sx,sy);x.stroke();for(const g of S.G){const gx=cx+g.x,gy=cy+g.y;x.fillStyle='#6C6C6C';x.strokeStyle='#111';x.lineWidth=4;x.beginPath();x.arc(gx,gy,g.r,0,Math.PI*2);x.fill();x.stroke()}for(const p of S.PP){const x0=cx+p.x,y0=cy+p.y;x.fillStyle='#fff';x.fillRect(x0-2,y0-2,4,4)}x.fillStyle='#111';x.font='bold 16px system-ui';x.fillText('Goblin sconfitti: '+S.sc,12,22)}</script></body></html>